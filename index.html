<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Calculadora de Ahorro & Retiro ‚Äî Christian GarBa</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@400;500;700&family=DM+Mono:wght@500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
  :root{
    --navy:#0A1D66;
    --electric:#1A4BFF;
    --gold:#F59E0B;
    --cream:#FFFBF5;
    --slate:#1E293B;
    --success:#10B981;
    --red:#EF4444;
    --orange:#F97316;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;overflow:hidden}
  body{
    font-family:'DM Sans',sans-serif;
    background:var(--cream);
    color:var(--slate);
    font-size:14px;
  }

  .app-container{
    display:grid;
    grid-template-columns:380px 1fr;
    height:100vh;
    position:relative;
  }

  .control-panel{
    background:linear-gradient(180deg, var(--navy) 0%, #0D2575 100%);
    color:var(--cream);
    padding:28px 24px;
    overflow-y:auto;
    box-shadow:8px 0 24px rgba(10,29,102,.2);
    position:relative;
    z-index:10;
  }

  .logo-header{
    margin-bottom:20px;
    padding-bottom:20px;
    border-bottom:1px solid rgba(255,251,245,.15);
  }
  .logo-header img{display:block;}
  .logo-title{
    font-family:'Playfair Display',serif;
    font-size:20px;
    font-weight:900;
    letter-spacing:-.02em;
    margin-bottom:4px;
  }
  .logo-subtitle{
    font-size:12px;
    opacity:.7;
    letter-spacing:.05em;
  }

  /* NUEVA SECCI√ìN DE ASESOR√çA - TEXTO INFORMATIVO */
  .asesoria-box{
    background:rgba(255,251,245,.08);
    border:2px solid rgba(245,158,11,.4);
    border-radius:10px;
    padding:18px 16px;
    margin-bottom:24px;
    text-align:center;
  }
  .asesoria-title{
    font-size:14px;
    font-weight:700;
    margin-bottom:14px;
    color:var(--gold);
    display:flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    letter-spacing:-.01em;
  }
  .asesoria-instruccion{
    font-size:12px;
    color:rgba(255,251,245,.85);
    margin-bottom:10px;
    font-weight:600;
  }
  .asesoria-mensaje{
    background:rgba(37,211,102,.15);
    border:1px solid rgba(37,211,102,.4);
    color:#D1FAE5;
    padding:10px 14px;
    border-radius:6px;
    font-size:13px;
    font-weight:700;
    margin-bottom:10px;
    font-family:'DM Mono',monospace;
  }
  .asesoria-phone{
    font-size:16px;
    font-weight:800;
    color:var(--cream);
    margin-top:8px;
    letter-spacing:.02em;
    font-family:'DM Mono',monospace;
  }

  .step-indicator{
    display:inline-block;
    width:24px;
    height:24px;
    background:var(--gold);
    color:var(--navy);
    border-radius:50%;
    text-align:center;
    line-height:24px;
    font-weight:900;
    font-size:13px;
    margin-right:8px;
  }

  .section-block{margin-bottom:28px;}
  .section-header{
    font-family:'Playfair Display',serif;
    font-size:16px;
    font-weight:700;
    margin-bottom:16px;
    color:var(--gold);
    letter-spacing:-.01em;
    display:flex;
    align-items:center;
  }

  .form-group{margin-bottom:14px;}
  .form-label{
    display:block;
    font-size:11px;
    font-weight:700;
    text-transform:uppercase;
    letter-spacing:.08em;
    margin-bottom:6px;
    opacity:.8;
  }
  .form-input{
    width:100%;
    padding:11px 14px;
    background:rgba(255,251,245,.12);
    border:1px solid rgba(255,251,245,.2);
    border-radius:6px;
    color:var(--cream);
    font-size:15px;
    font-weight:500;
    transition:all .2s;
    font-family:'DM Sans',sans-serif;
  }
  .form-input.suggested{
    background:rgba(245,158,11,.15);
    border-color:rgba(245,158,11,.4);
  }
  .form-input:focus{
    outline:none;
    background:rgba(255,251,245,.18);
    border-color:var(--gold);
    box-shadow:0 0 0 3px rgba(245,158,11,.15);
  }
  .form-input::placeholder{color:rgba(255,251,245,.4);}
  .form-input:disabled{
    opacity:.5;
    cursor:not-allowed;
  }
  .form-hint{font-size:10px;opacity:.6;margin-top:4px;line-height:1.4;}

  .suggestion-badge{
    display:inline-block;
    background:var(--gold);
    color:var(--navy);
    padding:4px 10px;
    border-radius:4px;
    font-size:11px;
    font-weight:800;
    margin-bottom:8px;
  }

  .btn-primary{
    width:100%;
    padding:14px;
    background:var(--gold);
    color:var(--navy);
    border:none;
    border-radius:6px;
    font-weight:700;
    font-size:13px;
    text-transform:uppercase;
    letter-spacing:.08em;
    cursor:pointer;
    transition:all .25s;
    box-shadow:0 4px 12px rgba(245,158,11,.3);
    font-family:'DM Sans',sans-serif;
  }
  .btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(245,158,11,.4);background:#FBBF24;}
  .btn-secondary{
    background:transparent;
    border:1px solid rgba(255,251,245,.3);
    color:var(--cream);
    box-shadow:none;
    margin-top:8px;
  }
  .btn-secondary:hover{background:rgba(255,251,245,.08);border-color:rgba(255,251,245,.5);}

  .collapsible-section{
    border:1px solid rgba(255,251,245,.15);
    border-radius:8px;
    margin-top:16px;
    overflow:hidden;
  }
  .collapsible-header{
    padding:12px 14px;
    background:rgba(255,251,245,.08);
    cursor:pointer;
    display:flex;
    justify-content:space-between;
    align-items:center;
    user-select:none;
  }
  .collapsible-header:hover{background:rgba(255,251,245,.12);}
  .collapsible-title{
    font-size:13px;
    font-weight:700;
    text-transform:uppercase;
    letter-spacing:.06em;
  }
  .collapsible-icon{
    transition:transform .2s;
  }
  .collapsible-header.open .collapsible-icon{
    transform:rotate(180deg);
  }
  .collapsible-content{
    display:none;
    padding:14px;
  }
  .collapsible-content.visible{
    display:block;
  }

  .error-alert{
    display:none;
    background:rgba(239,68,68,.15);
    border:1px solid rgba(239,68,68,.4);
    color:#FCA5A5;
    padding:10px 12px;
    border-radius:6px;
    font-size:12px;
    margin-bottom:12px;
    font-weight:500;
  }
  .error-alert.visible{display:block;}

  .results-panel{background:var(--cream);overflow-y:auto;position:relative;}

  .hero-section{
    background:linear-gradient(135deg, var(--navy) 0%, var(--electric) 100%);
    padding:40px 48px;
    position:relative;
    overflow:hidden;
  }
  .hero-section::before{
    content:'';
    position:absolute;top:0;right:0;width:400px;height:400px;
    background:radial-gradient(circle, rgba(245,158,11,.15) 0%, transparent 70%);
    pointer-events:none;
  }
  .hero-actions{
    position:absolute;top:20px;right:24px;display:flex;gap:10px;z-index:5;
  }
  .btn-action{
    padding:10px 18px;
    background:rgba(255,251,245,.15);
    backdrop-filter:blur(10px);
    border:1px solid rgba(255,251,245,.25);
    color:var(--cream);
    border-radius:6px;
    font-weight:700;
    font-size:12px;
    cursor:pointer;
    transition:.2s;
    text-transform:uppercase;
    letter-spacing:.05em;
  }
  .btn-action:hover{background:rgba(255,251,245,.25);transform:translateY(-1px);}
  .btn-action.accent{background:var(--gold);color:var(--navy);border-color:var(--gold);}
  .btn-action.accent:hover{background:#FBBF24;}

  .hero-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px;position:relative;z-index:2;}
  .hero-label{
    font-size:11px;text-transform:uppercase;letter-spacing:.12em;
    color:rgba(255,251,245,.7);margin-bottom:8px;font-weight:700;
  }
  .hero-value{
    font-family:'Playfair Display',serif;
    font-size:48px;font-weight:900;color:var(--cream);
    line-height:1;letter-spacing:-.02em;
    text-shadow:0 2px 8px rgba(0,0,0,.1);
  }
  .hero-value.highlight{color:var(--gold);font-size:64px;}
  .hero-caption{font-size:11px;color:rgba(255,251,245,.6);margin-top:6px;}

  .stats-container{padding:32px 48px;}
  .stats-title{
    font-family:'Playfair Display',serif;
    font-size:24px;
    font-weight:700;
    color:var(--navy);
    margin-bottom:20px;
    letter-spacing:-.01em;
  }

  .comparison-strip{
    display:grid;
    gap:12px;
    margin-bottom:24px;
  }
  .comp-box{
    padding:16px 12px;
    border-radius:8px;
    font-size:11px;
    font-weight:600;
    text-align:center;
    transition:.2s;
    border:2px solid;
  }
  .comp-box:hover{transform:translateY(-2px);}
  .comp-box.mattress{
    background:linear-gradient(135deg, #FEE2E2, #FECACA);
    color:#991B1B;
    border-color:var(--red);
  }
  .comp-box.bank{
    background:linear-gradient(135deg, #FED7AA, #FDBA74);
    color:#9A3412;
    border-color:var(--orange);
  }
  .comp-box.plan{
    background:linear-gradient(135deg, #D1FAE5, #A7F3D0);
    color:#065F46;
    border-color:var(--success);
    box-shadow:0 4px 12px rgba(16,185,129,.25);
  }
  .comp-label{
    font-size:9px;
    text-transform:uppercase;
    letter-spacing:.08em;
    font-weight:800;
    margin-bottom:6px;
  }
  .comp-value{
    font-family:'DM Mono',monospace;
    font-size:16px;
    font-weight:500;
    margin:6px 0;
  }
  .comp-loss{
    font-size:10px;
    font-weight:700;
    margin-top:4px;
  }

  .chart-section{
    background:white;
    padding:32px;
    border-radius:12px;
    box-shadow:0 2px 8px rgba(0,0,0,.06);
    margin-bottom:24px;
  }
  .chart-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:20px;
  }
  .chart-title{
    font-family:'Playfair Display',serif;
    font-size:20px;
    font-weight:700;
    color:var(--navy);
  }
  .chart-badge{
    background:linear-gradient(135deg, var(--electric), #3B82F6);
    color:white;
    padding:6px 14px;
    border-radius:20px;
    font-size:11px;
    font-weight:700;
    text-transform:uppercase;
    letter-spacing:.05em;
  }
  #chartCanvas{max-height:280px;}

  .retirement-section{
    display:none;
    background:linear-gradient(135deg, #ECFDF5 0%, #D1FAE5 100%);
    padding:28px 32px;
    border-radius:12px;
    border:2px solid var(--success);
    margin-bottom:24px;
  }
  .retirement-section.visible{
    display:block;
    animation:fadeIn .4s ease-out;
  }
  @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
  .retirement-title{
    font-family:'Playfair Display',serif;
    font-size:20px;
    font-weight:700;
    color:#065F46;
    margin-bottom:16px;
  }
  .retirement-grid{
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:16px;
  }
  .retirement-item{
    background:white;
    padding:16px;
    border-radius:8px;
    border-left:4px solid var(--success);
  }
  .retirement-label{
    font-size:10px;
    text-transform:uppercase;
    letter-spacing:.08em;
    color:#059669;
    font-weight:700;
    margin-bottom:6px;
  }
  .retirement-value{
    font-family:'DM Mono',monospace;
    font-size:22px;
    font-weight:500;
    color:#065F46;
  }

  .detail-wrapper{
    background:white;
    padding:24px 32px;
    border-radius:12px;
    box-shadow:0 2px 8px rgba(0,0,0,.06);
    margin-bottom:20px;
  }
  .detail-toggle{
    display:flex;
    justify-content:space-between;
    align-items:center;
    cursor:pointer;
    font-weight:700;
    color:var(--navy);
    font-size:14px;
    user-select:none;
  }
  .detail-toggle:hover{color:var(--electric);}
  .detail-toggle .icon{transition:transform .2s;}
  .detail-toggle.open .icon{transform:rotate(180deg);}
  .detail-content{
    display:none;
    margin-top:16px;
    max-height:240px;
    overflow-y:auto;
  }
  .detail-content.visible{
    display:block;
    animation:slideDown .3s ease-out;
  }
  @keyframes slideDown{from{opacity:0;max-height:0}to{opacity:1;max-height:240px}}
  table{
    width:100%;
    border-collapse:collapse;
    font-size:12px;
  }
  th{
    background:var(--navy);
    color:white;
    text-align:left;
    padding:10px 12px;
    font-weight:700;
    text-transform:uppercase;
    letter-spacing:.05em;
    font-size:11px;
  }
  td{
    padding:10px 12px;
    border-bottom:1px solid #E2E8F0;
  }
  tr:hover{background:#F8FAFC;}
  tr:last-child td{border-bottom:none;}

  .whatsapp-float{
    position:fixed;
    right:28px;
    bottom:28px;
    background:#25D366;
    color:white;
    padding:16px 24px;
    border-radius:50px;
    font-weight:700;
    font-size:14px;
    box-shadow:0 8px 24px rgba(37,211,102,.35);
    cursor:pointer;
    transition:.3s;
    z-index:100;
    text-decoration:none;
    display:flex;
    align-items:center;
    gap:8px;
  }
  .whatsapp-float:hover{
    transform:scale(1.05);
    box-shadow:0 12px 32px rgba(37,211,102,.5);
  }

  ::-webkit-scrollbar{width:8px;height:8px}
  ::-webkit-scrollbar-track{background:rgba(0,0,0,.05)}
  ::-webkit-scrollbar-thumb{background:var(--electric);border-radius:4px}
  ::-webkit-scrollbar-thumb:hover{background:var(--navy)}

  /* ============= PDF STYLES ============= */
  .report-view{display:none}

  @media print{
    body{
      background:white !important;
      color:#000 !important;
      -webkit-print-color-adjust:exact;
      print-color-adjust:exact;
      font-size:11px;
      overflow:visible;
    }
    html,body{height:auto;overflow:visible}
    .app-container{display:none !important}
    .whatsapp-float{display:none !important}
    .report-view{
      display:block !important;
      max-width:800px;
      margin:0 auto;
      padding:15mm;
    }

    .report-header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      padding-bottom:20px;
      margin-bottom:24px;
      border-bottom:4px solid var(--navy);
    }
    .report-logo-section{
      display:flex;
      gap:16px;
      align-items:center;
    }
    .report-logo{display:flex;gap:12px;align-items:center;}
    .report-logo img{display:block;}
    .report-branding{
      border-left:3px solid var(--gold);
      padding-left:16px;
    }
    .report-main-title{
      font-family:'Playfair Display',serif;
      font-size:24px;
      font-weight:900;
      color:var(--navy);
      margin-bottom:4px;
      letter-spacing:-.01em;
    }
    .report-subtitle{
      font-size:12px;
      color:#64748B;
    }
    .report-meta{
      text-align:right;
      font-size:10px;
      color:#64748B;
    }

    .report-hero{
      background:linear-gradient(135deg, #EFF6FF, #DBEAFE);
      border:3px solid var(--electric);
      border-radius:12px;
      padding:24px;
      margin-bottom:24px;
    }
    .report-hero-title{
      font-family:'Playfair Display',serif;
      font-size:18px;
      font-weight:700;
      color:var(--navy);
      margin-bottom:16px;
      text-align:center;
    }
    .report-hero-grid{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:16px;
    }
    .report-hero-item{
      background:white;
      padding:16px;
      border-radius:8px;
      border-left:4px solid var(--gold);
    }
    .report-hero-item.featured{
      grid-column:1/-1;
      background:linear-gradient(135deg,#D1FAE5,#A7F3D0);
      border-left-color:var(--success);
    }
    .report-hero-label{
      font-size:10px;
      color:#64748B;
      text-transform:uppercase;
      letter-spacing:.08em;
      font-weight:700;
      margin-bottom:6px;
    }
    .report-hero-item.featured .report-hero-label{
      color:#065F46;
    }
    .report-hero-value{
      font-family:'DM Mono',monospace;
      font-size:20px;
      font-weight:700;
      color:var(--navy);
    }
    .report-hero-item.featured .report-hero-value{
      font-size:26px;
      color:#065F46;
    }

    .report-comparison{
      margin-bottom:24px;
      page-break-inside:avoid;
    }
    .report-comparison-title{
      font-family:'Playfair Display',serif;
      font-size:16px;
      font-weight:700;
      color:var(--navy);
      margin-bottom:12px;
      text-align:center;
    }
    .report-comparison-grid{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:12px;
    }
    .report-comp-box{
      padding:16px;
      border-radius:8px;
      text-align:center;
      border:2px solid;
    }
    .report-comp-box.mattress{
      background:linear-gradient(135deg, #FEE2E2, #FECACA);
      border-color:#DC2626;
    }
    .report-comp-box.bank{
      background:linear-gradient(135deg, #FED7AA, #FDBA74);
      border-color:#EA580C;
    }
    .report-comp-box.afore{
      background:linear-gradient(135deg,#FEF3C7,#FDE68A);
      border-color:#F59E0B;
    }
    .report-comp-box.plan{
      background:linear-gradient(135deg, #D1FAE5, #A7F3D0);
      border-color:#10B981;
    }
    .report-comp-label{
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:.08em;
      font-weight:800;
      margin-bottom:8px;
    }
    .report-comp-value{
      font-family:'DM Mono',monospace;
      font-size:16px;
      font-weight:700;
      margin:6px 0;
    }
    .report-comp-loss{
      font-size:10px;
      font-weight:700;
      margin-top:4px;
    }
    .report-comp-message{
      text-align:center;
      margin-top:12px;
      font-size:12px;
      font-weight:700;
      color:var(--navy);
      background:#FEF3C7;
      padding:12px;
      border-radius:8px;
      border-left:4px solid var(--gold);
    }

    .report-section{
      margin-bottom:20px;
      page-break-inside:avoid;
    }
    .report-section-title{
      font-family:'Playfair Display',serif;
      font-size:16px;
      font-weight:700;
      color:var(--navy);
      margin-bottom:12px;
      padding-bottom:6px;
      border-bottom:2px solid var(--gold);
    }
    .report-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      margin-bottom:12px;
    }
    .report-item{
      background:#F8FAFC;
      padding:12px;
      border-radius:6px;
      border-left:3px solid var(--electric);
    }
    .report-item.featured{
      background:linear-gradient(135deg, #FEF3C7, #FDE68A);
      border-left-color:var(--gold);
      grid-column:1/-1;
    }
    .report-label{
      font-size:10px;
      color:#64748B;
      font-weight:700;
      margin-bottom:4px;
      text-transform:uppercase;
      letter-spacing:.05em;
    }
    .report-value{
      font-family:'DM Mono',monospace;
      font-size:14px;
      font-weight:500;
      color:var(--navy);
    }
    .report-item.featured .report-value{
      font-size:18px;
      font-weight:700;
    }
    .report-text{
      font-size:11px;
      line-height:1.6;
      color:#334155;
      margin:8px 0;
    }

    .report-table{
      width:100%;
      border-collapse:collapse;
      margin:12px 0;
      font-size:10px;
    }
    .report-table th{
      background:var(--navy);
      color:white;
      padding:8px 10px;
      text-align:left;
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:.05em;
    }
    .report-table td{
      padding:8px 10px;
      border-bottom:1px solid #E2E8F0;
    }
    .report-table tr:nth-child(even){
      background:#F8FAFC;
    }

    .report-highlight{
      background:linear-gradient(135deg, #EFF6FF, #DBEAFE);
      border-left:4px solid var(--electric);
      padding:14px;
      border-radius:6px;
      margin:12px 0;
    }
    .report-highlight strong{
      color:var(--navy);
      font-weight:700;
    }

    .report-footer{
      margin-top:28px;
      padding-top:16px;
      border-top:2px solid #E2E8F0;
      display:flex;
      justify-content:space-between;
      font-size:9px;
      color:#64748B;
    }
    .report-contact{
      font-weight:600;
    }
    .report-disclaimer{
      text-align:right;
      font-style:italic;
      max-width:400px;
    }

    .chart-print{
      max-width:100%;
      height:auto;
      margin:12px 0;
      page-break-inside:avoid;
    }

    .report-timeline{
      background:linear-gradient(135deg,#F0FDF4,#DCFCE7);
      border:2px solid var(--success);
      border-radius:12px;
      padding:20px;
      margin-bottom:20px;
    }
    .report-timeline-title{
      font-family:'Playfair Display',serif;
      font-size:16px;
      font-weight:700;
      color:#065F46;
      margin-bottom:16px;
      text-align:center;
    }
    .timeline-visual{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin:16px 0;
    }
    .timeline-point{
      text-align:center;
      flex:1;
    }
    .timeline-age{
      font-family:'DM Mono',monospace;
      font-size:18px;
      font-weight:700;
      color:#065F46;
      margin-bottom:4px;
    }
    .timeline-label{
      font-size:9px;
      color:#059669;
      text-transform:uppercase;
      letter-spacing:.06em;
      font-weight:700;
    }
    .timeline-amount{
      font-family:'DM Mono',monospace;
      font-size:14px;
      font-weight:700;
      color:#065F46;
      margin-top:4px;
    }
    .timeline-arrow{
      font-size:20px;
      color:#10B981;
      margin:0 8px;
    }
  }
</style>
</head>
<body>

<!-- =============== VISTA WEB =============== -->
<div class="app-container">
  
  <!-- Panel de Control -->
  <div class="control-panel">
    
    <div class="logo-header">
      <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px">
        <img src="./logo-garba.png" alt="Christian GarBa" style="height:44px;width:auto;filter:brightness(0) invert(1)">
        <div style="width:1px;height:40px;background:rgba(255,251,245,.2)"></div>
        <img src="./logo-allianz.png" alt="Allianz" style="height:36px;width:auto;filter:brightness(0) invert(1)">
      </div>
      <div class="logo-title">Christian GarBa</div>
      <div class="logo-subtitle">Seguros con Estrategia ¬∑ Allianz</div>
      <div style="font-size:11px;opacity:.7;margin-top:8px;letter-spacing:.03em">üåê sfgarba.com/Blog</div>
    </div>

    <!-- NUEVA SECCI√ìN DE ASESOR√çA - TEXTO INFORMATIVO -->
    <div class="asesoria-box">
      <div class="asesoria-title">
        üíº ¬øQuieres una asesor√≠a personalizada?
      </div>
      <div class="asesoria-instruccion">
        üì± Env√≠a por WhatsApp:
      </div>
      <div class="asesoria-mensaje">
        üí¨ "Quiero mi plan de retiro"
      </div>
      <div class="asesoria-phone">
        üìû 662 417 6032
      </div>
    </div>

    <!-- Secci√≥n 1: Datos Principales -->
    <div class="section-block">
      <div class="section-header">
        <span class="step-indicator">1</span>
        Tus Datos
      </div>
      
      <div class="form-group">
        <label class="form-label">Tu nombre (opcional)</label>
        <input class="form-input" id="nombreOpt" type="text" placeholder="Ej. Fernanda">
      </div>

      <div class="form-group">
        <label class="form-label">Edad actual</label>
        <input class="form-input" id="edad" type="number" min="18" max="100" value="29">
      </div>

      <div class="form-group">
        <label class="form-label">A√±os que aportar√°s</label>
        <select class="form-input" id="years">
          <option value="10">10 a√±os</option>
          <option value="15" selected>15 a√±os</option>
          <option value="20">20 a√±os</option>
          <option value="25">25 a√±os</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Meta mensual deseada (valor de hoy)</label>
        <input class="form-input" id="metaHoy" type="number" min="0" step="1000" placeholder="32,000" value="32000">
        <div class="form-hint">¬øCu√°nto quieres recibir mensualmente en tu retiro?</div>
      </div>
    </div>

    <!-- Secci√≥n 2: Aportaci√≥n -->
    <div class="section-block">
      <div class="section-header">
        <span class="step-indicator">2</span>
        Tu Aportaci√≥n
      </div>

      <div class="error-alert" id="errorMsg"></div>

      <div class="form-group">
        <label class="form-label">
          <span class="suggestion-badge" id="suggestedBadge" style="display:none">üí° Sugerido</span>
          Aportaci√≥n mensual
        </label>
        <input class="form-input" id="pmt" type="number" value="2500" min="0" step="0.01">
        <div class="form-hint" id="pmtHint">Calcula tu plan para ver la aportaci√≥n sugerida</div>
      </div>

      <div class="form-group">
        <label class="form-label">Frecuencia</label>
        <select class="form-input" id="frequency">
          <option value="12" selected>Mensual</option>
          <option value="4">Trimestral</option>
          <option value="2">Semestral</option>
          <option value="1">Anual</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Aportaci√≥n √∫nica inicial</label>
        <input class="form-input" id="lumpSum" type="number" value="0" min="0" step="0.01">
      </div>

      <div class="form-group">
        <label class="form-label">R√©gimen fiscal</label>
        <select class="form-input" id="regimenFiscal">
          <option value="ninguno">Sin beneficio fiscal</option>
          <option value="93">Art. 93 (diferido)</option>
          <option value="151">Art. 151 (deducible)</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Devoluci√≥n ISR (%)</label>
        <select class="form-input" id="isrPct" disabled>
          <option value="0">0%</option>
          <option value="10">10%</option>
          <option value="20" selected>20%</option>
          <option value="30">30%</option>
          <option value="35">35%</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label" style="display:flex;align-items:center;gap:8px;opacity:.5">
          <input id="reinvertISR" type="checkbox" checked style="width:auto;margin:0" disabled>
          Reinvertir devoluci√≥n fiscal
        </label>
      </div>

      <!-- Par√°metros Avanzados Colapsables -->
      <div class="collapsible-section">
        <div class="collapsible-header" id="advancedToggle">
          <span class="collapsible-title">‚öôÔ∏è Par√°metros Avanzados</span>
          <span class="collapsible-icon">‚ñº</span>
        </div>
        <div class="collapsible-content" id="advancedContent">
          
          <div class="form-group">
            <label class="form-label">Rendimiento esperado (%)</label>
            <input class="form-input" id="rate" type="number" value="10" min="0" max="100" step="0.01">
          </div>

          <div class="form-group">
            <label class="form-label">Inflaci√≥n promedio (%)</label>
            <input class="form-input" id="inflation" type="number" value="4" min="0" max="100" step="0.01">
          </div>

        </div>
      </div>

      <button class="btn-primary" id="calcBtn" style="margin-top:16px">Calcular Proyecci√≥n</button>
      <button class="btn-primary btn-secondary" id="resetBtn">Reiniciar Todo</button>
    </div>

    <!-- Secci√≥n 3: Retiro -->
    <div class="section-block">
      <div class="section-header">
        <span class="step-indicator">3</span>
        Tu Retiro
      </div>
      
      <input type="hidden" id="pvRet" value="0">

      <div class="form-group">
        <label class="form-label">A√±os de retiro</label>
        <select class="form-input" id="yrsRetSel">
          <option value="15">15 a√±os</option>
          <option value="20" selected>20 a√±os</option>
          <option value="25">25 a√±os</option>
        </select>
      </div>

      <button class="btn-primary" id="calcRet">Calcular Mensualidad</button>
    </div>

  </div>

  <!-- Panel de Resultados -->
  <div class="results-panel">
    
    <!-- Hero Section -->
    <div class="hero-section">
      <div class="hero-actions">
        <button class="btn-action" id="csvBtn">CSV</button>
        <button class="btn-action accent" id="printBtn">Generar PDF</button>
      </div>

      <div class="hero-grid">
        <div>
          <div class="hero-label">Fondo al finalizar plan</div>
          <div class="hero-value highlight" id="fondoPlan">‚Äî</div>
          <div class="hero-caption">A tu edad: <span id="edadFinPlan">‚Äî</span></div>
        </div>
        <div>
          <div class="hero-label">Fondo a los 65 a√±os</div>
          <div class="hero-value" id="fondo65">‚Äî</div>
          <div class="hero-caption">Listo para retiro</div>
        </div>
        <div>
          <div class="hero-label">Total aportado</div>
          <div class="hero-value" id="totalAportado">‚Äî</div>
          <div class="hero-caption">Durante <span id="yearsPlan">‚Äî</span> a√±os</div>
        </div>
        <div>
          <div class="hero-label">Rendimiento generado</div>
          <div class="hero-value" id="rendimiento">‚Äî</div>
          <div class="hero-caption">Hasta los 65 a√±os</div>
        </div>
      </div>
    </div>

    <!-- Stats Container -->
    <div class="stats-container">
      
      <!-- Comparativa 4 Columnas con Barras -->
      <div style="margin-bottom:24px">
        <div style="font-family:'Playfair Display',serif;font-size:22px;font-weight:700;color:var(--navy);margin-bottom:16px;text-align:center">
          <span id="compTitle">¬øD√≥nde est√° tu dinero en 15 a√±os?</span>
        </div>
        <div class="comparison-strip" style="grid-template-columns:repeat(4,1fr);gap:10px">
          <div class="comp-box mattress">
            <div class="comp-label">üí∏ COLCH√ìN</div>
            <div class="comp-value" id="compMattress">‚Äî</div>
            <div style="margin:8px 0">
              <div style="background:#DC2626;height:8px;border-radius:4px;width:20%"></div>
            </div>
            <div class="comp-loss" id="compMattressLoss">‚Äî</div>
          </div>
          <div class="comp-box bank">
            <div class="comp-label">üè¶ BANCO</div>
            <div class="comp-value" id="compBank">‚Äî</div>
            <div style="margin:8px 0">
              <div style="background:#EA580C;height:8px;border-radius:4px;width:24%"></div>
            </div>
            <div class="comp-loss" id="compBankLoss">‚Äî</div>
          </div>
          <div class="comp-box" style="background:linear-gradient(135deg,#FEF3C7,#FDE68A);color:#92400E;border-color:#F59E0B">
            <div class="comp-label">üèõÔ∏è AFORE</div>
            <div class="comp-value" id="compAfore">‚Äî</div>
            <div style="margin:8px 0">
              <div style="background:#F59E0B;height:8px;border-radius:4px;width:38%"></div>
            </div>
            <div class="comp-loss" id="compAforeLoss">‚Äî</div>
          </div>
          <div class="comp-box plan">
            <div class="comp-label">‚ú® TU PLAN</div>
            <div class="comp-value" id="compPlan">‚Äî</div>
            <div style="margin:8px 0">
              <div style="background:#10B981;height:8px;border-radius:4px;width:100%"></div>
            </div>
            <div class="comp-loss" style="color:#065F46">‚úì Protegido</div>
          </div>
        </div>
        <div style="text-align:center;font-size:13px;font-weight:700;color:var(--navy);margin-top:12px;background:#FEF3C7;padding:14px;border-radius:8px;border-left:4px solid var(--gold)">
          <span id="compMessage">Mismo esfuerzo. Cuatro caminos. Resultados completamente diferentes.</span>
        </div>
      </div>

      <!-- Resultados de retiro -->
      <div class="retirement-section" id="retBox">
        <div class="retirement-title">Tu Ingreso Mensual en Retiro</div>
        <div class="retirement-grid">
          <div class="retirement-item">
            <div class="retirement-label">Ingreso mensual</div>
            <div class="retirement-value" id="pmtReal">‚Äî</div>
          </div>
          <div class="retirement-item">
            <div class="retirement-label">Meses de retiro</div>
            <div class="retirement-value" id="nMeses">‚Äî</div>
          </div>
          <div class="retirement-item">
            <div class="retirement-label">Tasa real mensual</div>
            <div class="retirement-value" id="iRealMes">‚Äî</div>
          </div>
          <div class="retirement-item">
            <div class="retirement-label">Regla 4% anual</div>
            <div class="retirement-value" id="rule4">‚Äî</div>
          </div>
        </div>
      </div>

      <!-- Detalles a√±o por a√±o (colapsable) -->
      <div class="detail-wrapper">
        <div class="detail-toggle" id="toggleTable">
          <span>üìä Detalles a√±o por a√±o</span>
          <span class="icon">‚ñº</span>
        </div>
        <div class="detail-content" id="details">
          <table>
            <thead>
              <tr>
                <th>A√±o</th>
                <th>Edad</th>
                <th>Aportado</th>
                <th>Beneficio fiscal</th>
                <th>Saldo</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
      </div>

      <!-- Detalle retiro (colapsable) -->
      <div class="detail-wrapper">
        <div class="detail-toggle" id="toggleTableRet">
          <span>üìã Detalle mensual del retiro</span>
          <span class="icon">‚ñº</span>
        </div>
        <div class="detail-content" id="detailsRet">
          <table>
            <thead>
              <tr>
                <th>Mes</th>
                <th>Edad</th>
                <th>Retiro</th>
                <th>Inter√©s</th>
                <th>Saldo</th>
              </tr>
            </thead>
            <tbody id="tbodyRet"></tbody>
          </table>
        </div>
      </div>

    </div>

  </div>

</div>

<!-- WhatsApp flotante -->
<a id="waBtn" class="whatsapp-float" target="_blank" rel="noopener">
  <span>üí¨</span> WhatsApp
</a>

<!-- =============== VISTA PDF =============== -->
<div class="report-view">
  
  <div class="report-header">
    <div class="report-logo-section">
      <div class="report-logo">
        <img src="./logo-garba.png" alt="GarBa" style="height:48px">
        <div style="width:2px;height:45px;background:#E2E8F0"></div>
        <img src="./logo-allianz.png" alt="Allianz" style="height:38px">
      </div>
      <div class="report-branding">
        <div class="report-main-title">Tu Plan de Retiro</div>
        <div class="report-subtitle">Proyecci√≥n financiera personalizada</div>
      </div>
    </div>
    <div class="report-meta">
      <div id="rptFecha"></div>
      <div><strong>Asesor:</strong> Christian GarBa</div>
      <div>Seguros con Estrategia ¬∑ Allianz</div>
      <div>Tel. 662 417 6032</div>
    </div>
  </div>

  <!-- Timeline Visual -->
  <div class="report-timeline">
    <div class="report-timeline-title">üìà Tu L√≠nea de Tiempo Financiera</div>
    <div class="timeline-visual">
      <div class="timeline-point">
        <div class="timeline-age" id="rptEdadHoy">29</div>
        <div class="timeline-label">HOY</div>
        <div class="timeline-amount">Comienzas</div>
      </div>
      <div class="timeline-arrow">‚Üí</div>
      <div class="timeline-point">
        <div class="timeline-age" id="rptEdadFinPlan">44</div>
        <div class="timeline-label">FIN APORTACIONES</div>
        <div class="timeline-amount" id="rptFondoFinPlan">‚Äî</div>
      </div>
      <div class="timeline-arrow">‚Üí</div>
      <div class="timeline-point">
        <div class="timeline-age">65</div>
        <div class="timeline-label">RETIRO</div>
        <div class="timeline-amount" id="rptFondo65Timeline">‚Äî</div>
      </div>
    </div>
    <div style="text-align:center;margin-top:12px;font-size:11px;color:#065F46;font-weight:600">
      <span id="rptYearsGrowth">21 a√±os</span> de crecimiento adicional sin aportar
    </div>
  </div>

  <!-- Hero Resumen -->
  <div class="report-hero">
    <div class="report-hero-title">Tu Plan en N√∫meros</div>
    <div class="report-hero-grid">
      <div class="report-hero-item">
        <div class="report-hero-label">Ahorras mensualmente</div>
        <div class="report-hero-value" id="rptAportMensual">‚Äî</div>
      </div>
      <div class="report-hero-item">
        <div class="report-hero-label">Durante</div>
        <div class="report-hero-value" id="rptPlazo">‚Äî</div>
      </div>
      <div class="report-hero-item">
        <div class="report-hero-label">Total invertido</div>
        <div class="report-hero-value" id="rptTotalAportado">‚Äî</div>
      </div>
      <div class="report-hero-item">
        <div class="report-hero-label">Acumulas al fin del plan</div>
        <div class="report-hero-value" id="rptFondoPlan">‚Äî</div>
      </div>
      <div class="report-hero-item featured">
        <div class="report-hero-label">üí∞ Fondo a los 65 a√±os</div>
        <div class="report-hero-value" id="rptFondo65">‚Äî</div>
      </div>
      <div class="report-hero-item featured">
        <div class="report-hero-label">üìä Ingreso mensual en retiro</div>
        <div class="report-hero-value" id="rptIngresoMensual">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- Comparativa -->
  <div class="report-comparison">
    <div class="report-comparison-title" id="rptCompTitle">¬øD√≥nde est√° tu dinero en 15 a√±os?</div>
    <div class="report-comparison-grid">
      <div class="report-comp-box mattress">
        <div class="report-comp-label" style="color:#991B1B">üí∏ COLCH√ìN</div>
        <div class="report-comp-value" style="color:#991B1B" id="rptCompMattress">‚Äî</div>
        <div style="margin:6px auto;width:80%">
          <div style="background:#DC2626;height:6px;border-radius:3px;width:20%"></div>
        </div>
        <div class="report-comp-loss" style="color:#991B1B" id="rptCompMattressLoss">‚Äî</div>
      </div>
      <div class="report-comp-box bank">
        <div class="report-comp-label" style="color:#9A3412">üè¶ BANCO</div>
        <div class="report-comp-value" style="color:#9A3412" id="rptCompBank">‚Äî</div>
        <div style="margin:6px auto;width:80%">
          <div style="background:#EA580C;height:6px;border-radius:3px;width:24%"></div>
        </div>
        <div class="report-comp-loss" style="color:#9A3412" id="rptCompBankLoss">‚Äî</div>
      </div>
      <div class="report-comp-box afore">
        <div class="report-comp-label" style="color:#92400E">üèõÔ∏è AFORE</div>
        <div class="report-comp-value" style="color:#92400E" id="rptCompAfore">‚Äî</div>
        <div style="margin:6px auto;width:80%">
          <div style="background:#F59E0B;height:6px;border-radius:3px;width:38%"></div>
        </div>
        <div class="report-comp-loss" style="color:#92400E" id="rptCompAforeLoss">‚Äî</div>
      </div>
      <div class="report-comp-box plan">
        <div class="report-comp-label" style="color:#065F46">‚ú® TU PLAN</div>
        <div class="report-comp-value" style="color:#065F46" id="rptCompPlan">‚Äî</div>
        <div style="margin:6px auto;width:80%">
          <div style="background:#10B981;height:6px;border-radius:3px;width:100%"></div>
        </div>
        <div class="report-comp-loss" style="color:#065F46">‚úì Protegido</div>
      </div>
    </div>
    <div class="report-comp-message">
      <strong>Mismo esfuerzo. Cuatro caminos. Resultados completamente diferentes.</strong><br>
      La inflaci√≥n destruye el ahorro pasivo. El AFORE es limitado. Tu plan personalizado protege y multiplica.
    </div>
  </div>

  <!-- Datos del Cliente -->
  <div class="report-section">
    <div class="report-section-title">1. Datos del Cliente</div>
    <div class="report-grid">
      <div class="report-item">
        <div class="report-label">Nombre</div>
        <div class="report-value" id="rptNombre">‚Äî</div>
      </div>
      <div class="report-item">
        <div class="report-label">Edad actual</div>
        <div class="report-value" id="rptEdad">‚Äî</div>
      </div>
      <div class="report-item">
        <div class="report-label">Meta mensual deseada</div>
        <div class="report-value" id="rptMetaHoy">‚Äî</div>
      </div>
      <div class="report-item">
        <div class="report-label">Aportaci√≥n mensual elegida</div>
        <div class="report-value" id="rptAportReal">‚Äî</div>
      </div>
    </div>
    <div class="report-text" id="rptSupuestos1"></div>
    <div class="report-text" id="rptSupuestosFiscal"></div>
  </div>

  <!-- Costo de Posponer -->
  <div class="report-section">
    <div class="report-section-title">2. El Costo de Posponer</div>
    <table class="report-table">
      <thead>
        <tr>
          <th>Momento de inicio</th>
          <th>Aportaci√≥n mensual necesaria</th>
          <th>Incremento</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Empiezas hoy</strong></td>
          <td id="rptHoyMonto">‚Äî</td>
          <td id="rptHoyDelta">‚Äî</td>
        </tr>
        <tr>
          <td>Dentro de 1 a√±o</td>
          <td id="rpt1Monto">‚Äî</td>
          <td id="rpt1Delta">‚Äî</td>
        </tr>
        <tr>
          <td>Dentro de 3 a√±os</td>
          <td id="rpt3Monto">‚Äî</td>
          <td id="rpt3Delta">‚Äî</td>
        </tr>
        <tr>
          <td>Dentro de 5 a√±os</td>
          <td id="rpt5Monto">‚Äî</td>
          <td id="rpt5Delta">‚Äî</td>
        </tr>
      </tbody>
    </table>
    <div class="report-highlight">
      <strong>Conclusi√≥n:</strong> <span id="rptMensajePosponer"></span>
    </div>
  </div>

  <div class="report-footer">
    <div class="report-contact">
      <strong>Christian GarBa</strong> ¬∑ Seguros con Estrategia ¬∑ Allianz<br>
      Tel. 662 417 6032 ¬∑ <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="adcec5dfc4ded9c4ccc383caccdfcec4cceddecbcaccdfcfcc83cec2c083c0d5">[email&#160;protected]</a>
    </div>
    <div class="report-disclaimer">
      <strong>Disclaimer:</strong> Este documento es una proyecci√≥n ilustrativa con fines informativos, 
      basada en rendimientos promedio hist√≥ricos y supuestos conservadores. Los rendimientos reales 
      pueden variar. No constituye oferta vinculante ni garantiza resultados futuros.
    </div>
  </div>

</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
  const $ = id => document.getElementById(id);
  const money = v => new Intl.NumberFormat('es-MX',{style:'currency',currency:'MXN',minimumFractionDigits:0,maximumFractionDigits:0}).format(Number(v)||0);
  const freqMap = {'12':'Mensual','4':'Trimestral','2':'Semestral','1':'Anual'};

  const reportState = {
    nombre:'',edad:null,metaHoy:null,planYears:null,pmtSugerido:null,
    infl:null,rAcc:null,rRet:null,yrsRet:null,
    totalAportado:0,rendimiento:0,fondoPlan:0,fondo65:0,benefFiscal:0,
    ingresoMensual:0,tasaRealMes:0,regimenFiscal:'ninguno',isrPct:0,
    delayScenarios:null,chartData:null,edadFinPlan:0,yearsGrowth:0
  };

  let myChart = null;
  let userEditedPMT = false;

  // L√≥gica fiscal Art. 93 vs 151
  $('regimenFiscal').addEventListener('change',function(){
    const is151 = this.value === '151';
    const is93 = this.value === '93';
    
    if(is93){
      // Art. 93: deshabilitar ISR y reinvertir
      $('isrPct').disabled = true;
      $('reinvertISR').disabled = true;
      $('isrPct').parentElement.style.opacity = '0.5';
      $('reinvertISR').parentElement.style.opacity = '0.5';
    }else if(is151){
      // Art. 151: habilitar ISR, reinvertir es opcional
      $('isrPct').disabled = false;
      $('reinvertISR').disabled = false;
      $('isrPct').parentElement.style.opacity = '1';
      $('reinvertISR').parentElement.style.opacity = '1';
    }else{
      // Sin beneficio fiscal
      $('isrPct').disabled = true;
      $('reinvertISR').disabled = true;
      $('isrPct').parentElement.style.opacity = '0.5';
      $('reinvertISR').parentElement.style.opacity = '0.5';
    }
  });

  function linkWhatsApp(){
    const nombre = ($('nombreOpt').value||'').trim();
    const msg = [
      'Hola Christian, me interesa revisar mi plan de retiro.',
      nombre?('Soy '+nombre+'.'):'',
      '*Datos:*',
      `‚Ä¢ Edad: ${$('edad').value} a√±os`,
      `‚Ä¢ A√±os de aportaci√≥n: ${$('years').value}`,
      `‚Ä¢ Aportaci√≥n ${freqMap[$('frequency').value]}: $${$('pmt').value}`
    ].filter(Boolean).join('\n');
    $('waBtn').href = 'https://wa.me/5216624176032?text='+encodeURIComponent(msg);
  }

  function calcularPMTRequerido(edadInicio, planY, metaHoy, infl, rAcc, rRet, yrsRet, freq){
    if(!(edadInicio>0 && planY>0 && metaHoy>0)) return 0;
    const yrsTo65=Math.max(0,65-edadInicio);
    const yrsAport=Math.min(planY,yrsTo65);
    const gapYears=Math.max(0,yrsTo65-yrsAport);
    if(yrsAport<=0)return 0;
    const inflDec=infl/100,rAccDec=rAcc/100,rRetDec=rRet/100;
    const metaNom65=metaHoy*Math.pow(1+inflDec,yrsTo65);
    const iRet=rRetDec/freq,nRet=yrsRet*freq;
    const PVneed65=Math.abs(iRet)<1e-12?metaNom65*nRet:metaNom65*((1-Math.pow(1+iRet,-nRet))/iRet);
    const iAcc=rAccDec/freq,N=yrsAport*freq;
    let FV_pagos=0,pmtYear=1;
    for(let y=0;y<yrsAport;y++){
      if(y>0)pmtYear*=(1+inflDec);
      for(let m=0;m<freq;m++){
        const perRest=N-(y*freq+m);
        FV_pagos+=pmtYear*Math.pow(1+iAcc,perRest);
      }
    }
    const growTo65=Math.pow(1+iAcc,gapYears*freq);
    const totalFactor=FV_pagos*growTo65;
    return totalFactor<=0?0:PVneed65/totalFactor;
  }

  function updateSuggestion(){
    const edad=parseFloat($('edad').value);
    const planY=parseFloat($('years').value);
    const metaHoy=parseFloat($('metaHoy').value||0);
    const infl=parseFloat($('inflation').value);
    const rAcc=parseFloat($('rate').value);
    const rRet=7;
    const yrsRet=parseInt($('yrsRetSel').value||20,10);
    const freq=12;

    if(!(edad>0&&planY>0&&metaHoy>0)) return;

    const pmt0=calcularPMTRequerido(edad,planY,metaHoy,infl,rAcc,rRet,yrsRet,freq);

    const delays=[0,1,3,5];
    const escenarios={};
    delays.forEach(d=>{
      escenarios[d]=calcularPMTRequerido(edad+d,planY,metaHoy,infl,rAcc,rRet,yrsRet,freq);
    });

    reportState.metaHoy=metaHoy;
    reportState.planYears=planY;
    reportState.pmtSugerido=pmt0;
    reportState.infl=infl;
    reportState.rAcc=rAcc;
    reportState.rRet=rRet;
    reportState.yrsRet=yrsRet;
    reportState.delayScenarios=escenarios;

    if(!userEditedPMT){
      $('pmt').value=String(pmt0.toFixed(2));
      $('pmt').classList.add('suggested');
    }
    $('suggestedBadge').style.display='inline-block';
    $('pmtHint').innerHTML=`üí° Sugerido: <strong>${money(pmt0)}</strong> para alcanzar tu meta`;
  }

  function calcAccum(){
    const edad=parseFloat($('edad').value);
    const years=parseFloat($('years').value);
    const pmt0=parseFloat($('pmt').value);
    const lump=parseFloat($('lumpSum').value);
    const rate=parseFloat($('rate').value)/100;
    const freq=parseFloat($('frequency').value);
    const infl=parseFloat($('inflation').value)/100;

    const regimen=$('regimenFiscal').value;
    const isrPct=parseFloat($('isrPct').value)/100;
    const reinv=$('reinvertISR').checked;

    if([edad,years,pmt0,lump,rate,freq,infl].some(x=>isNaN(x))){
      const e=$('errorMsg');
      e.textContent='‚ùå Completa todos los campos correctamente.';
      e.classList.add('visible');
      return;
    }else{
      $('errorMsg').classList.remove('visible');
    }

    const yrsTo65=Math.max(0,65-edad);
    const yrsAport=years;
    const yrsExtra=Math.max(0,yrsTo65-yrsAport);
    const i=rate/freq;

    let saldo=lump,totalAportado=lump,benefFiscal=0,edadAct=edad,pmtYear=pmt0,fondoPlan=lump;
    const tbody=$('tbody');
    tbody.innerHTML='';
    const totalYearsSim=yrsAport+yrsExtra;
    const chartLabels=[],chartData=[];

    for(let yr=1;yr<=totalYearsSim;yr++){
      edadAct++;
      let aportAno=0,benefAno=0;

      if(yr<=yrsAport){
        if(yr>1)pmtYear*=(1+infl);
        for(let k=0;k<freq;k++){
          saldo*=(1+i);
          saldo+=pmtYear;
          aportAno+=pmtYear;
          totalAportado+=pmtYear;
        }
        if(regimen==='151'&&reinv&&isrPct>0){
          benefAno=aportAno*isrPct;
          saldo+=benefAno;
          benefFiscal+=benefAno;
        }
      }else{
        for(let k=0;k<freq;k++)saldo*=(1+i);
      }

      if(yr===yrsAport)fondoPlan=saldo;

      chartLabels.push(`A√±o ${yr}`);
      chartData.push(saldo);

      const tr=document.createElement('tr');
      if(yr>yrsAport)tr.style.background='rgba(148,163,184,.08)';
      tr.innerHTML=`
        <td>${yr}</td>
        <td>${Math.round(edadAct)}</td>
        <td>${yr>yrsAport?'‚Äî':money(aportAno)}</td>
        <td>${benefAno>0?money(benefAno):'‚Äî'}</td>
        <td>${money(saldo)}</td>
      `;
      tbody.appendChild(tr);
    }

    const fondo65=saldo;
    const rendimiento=fondo65-totalAportado;
    const edadFinPlan=edad+yrsAport;

    $('edadFinPlan').textContent=String(Math.round(edadFinPlan));
    $('fondoPlan').textContent=money(fondoPlan);
    $('yearsPlan').textContent=String(yrsAport);
    $('totalAportado').textContent=money(totalAportado);
    $('rendimiento').textContent=money(rendimiento);
    $('fondo65').textContent=money(fondo65);
    $('pvRet').value=String(fondo65);

    // Actualizar t√≠tulo comparativa din√°micamente
    $('compTitle').textContent=`¬øD√≥nde est√° tu dinero en ${yrsAport} a√±os?`;

    reportState.edad=edad;
    reportState.totalAportado=totalAportado;
    reportState.rendimiento=rendimiento;
    reportState.fondoPlan=fondoPlan;
    reportState.fondo65=fondo65;
    reportState.benefFiscal=benefFiscal;
    reportState.regimenFiscal=regimen;
    reportState.isrPct=isrPct*100;
    reportState.chartData={labels:chartLabels,data:chartData};
    reportState.edadFinPlan=edadFinPlan;
    reportState.yearsGrowth=yrsExtra;

    // Comparativa colch√≥n/banco/afore/plan usando a√±os reales
    const totalMeses=years*12;
    const aportMensual=pmt0;
    
    const colchonNominal=totalMeses*aportMensual;
    const colchonReal=colchonNominal/Math.pow(1+infl,years);
    
    const iBanco=0.02/12;
    let saldoBanco=0;
    for(let m=0;m<totalMeses;m++){
      saldoBanco*=(1+iBanco);
      saldoBanco+=aportMensual;
    }
    const bancoReal=saldoBanco/Math.pow(1+infl,years);
    
    const iAfore=0.09/12;
    let saldoAfore=0;
    for(let m=0;m<totalMeses;m++){
      saldoAfore*=(1+iAfore);
      saldoAfore+=aportMensual;
    }
    
    $('compMattress').textContent=money(colchonNominal);
    $('compMattressLoss').textContent=`Vale: ${money(colchonReal)}`;
    
    $('compBank').textContent=money(saldoBanco);
    $('compBankLoss').textContent=`Vale: ${money(bancoReal)}`;
    
    $('compAfore').textContent=money(saldoAfore);
    $('compAforeLoss').textContent=`Pensi√≥n limitada`;
    
    $('compPlan').textContent=money(fondoPlan);
    
    const diffTotal=fondoPlan-colchonNominal;
    $('compMessage').textContent=`Mismo esfuerzo. Cuatro caminos. Diferencia de ${money(diffTotal)} entre el peor y mejor escenario.`;

    actualizarGrafica(chartLabels,chartData);
    actualizarReporteBase();
    linkWhatsApp();
  }

  function actualizarGrafica(labels,data){
    const ctx=$('chartCanvas');
    if(!ctx) return;
    const context = ctx.getContext('2d');
    if(myChart)myChart.destroy();
    myChart=new Chart(context,{
      type:'line',
      data:{
        labels:labels,
        datasets:[{
          label:'Fondo Acumulado (MXN)',
          data:data,
          borderColor:'#1A4BFF',
          backgroundColor:'rgba(26,75,255,0.08)',
          borderWidth:3,
          fill:true,
          tension:0.4,
          pointRadius:0,
          pointHoverRadius:6,
          pointBackgroundColor:'#0A1D66',
          pointHoverBackgroundColor:'#F59E0B'
        }]
      },
      options:{
        responsive:true,
        maintainAspectRatio:true,
        plugins:{
          legend:{display:false},
          tooltip:{
            backgroundColor:'rgba(10,29,102,0.95)',
            padding:12,
            titleFont:{size:13,weight:'bold'},
            bodyFont:{size:12},
            callbacks:{
              label:function(context){
                return 'Fondo: '+money(context.parsed.y);
              }
            }
          }
        },
        scales:{
          y:{
            beginAtZero:true,
            ticks:{
              callback:function(value){
                return '$'+(value/1000000).toFixed(1)+'M';
              },
              font:{size:11},
              color:'#64748B'
            },
            grid:{color:'rgba(0,0,0,0.05)'}
          },
          x:{
            ticks:{
              font:{size:10},
              color:'#64748B',
              maxRotation:0,
              autoSkip:true,
              maxTicksLimit:12
            },
            grid:{display:false}
          }
        }
      }
    });
  }

  function calcRet(){
    const PV=parseFloat($('pvRet').value)||0;
    const yrs=parseInt($('yrsRetSel').value,10);
    const rateRet=7/100;
    const infl=4/100;
    if(PV<=0){alert('‚ö†Ô∏è Primero calcula tu ahorro.');return;}

    const iNom=rateRet/12;
    const n=yrs*12;
    const PMT=Math.abs(iNom)<1e-9?PV/n:PV*(iNom/(1-Math.pow(1+iNom,-n)));
    const rReal=((1+rateRet)/(1+infl))-1;
    const iReal=rReal/12;

    $('retBox').classList.add('visible');
    $('pmtReal').textContent=money(PMT);
    $('nMeses').textContent=`${n}`;
    $('iRealMes').textContent=`${(iReal*100).toFixed(3)}%`;
    $('rule4').textContent=`${money(PV*0.04)} /a√±o`;

    const tbodyRet=$('tbodyRet');
    tbodyRet.innerHTML='';
    let saldo=PV;
    for(let m=1;m<=Math.min(n,240);m++){
      const interes=saldo*iNom;
      const retiro=PMT;
      const saldoDesp=Math.max(0,saldo+interes-retiro);
      const yearsAdd=Math.floor(m/12);
      const edadTxt=`${65+yearsAdd}`;
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${m}</td><td>${edadTxt}</td><td>${money(retiro)}</td><td>${money(interes)}</td><td>${money(saldoDesp)}</td>`;
      tbodyRet.appendChild(tr);
      saldo=saldoDesp;
    }

    reportState.ingresoMensual=PMT;
    reportState.yrsRet=yrs;
    reportState.tasaRealMes=iReal;
    reportState.rRet=7;
    actualizarReporteBase();
  }

  function actualizarReporteBase(){
    const nombre=($('nombreOpt').value||'').trim();
    reportState.nombre=nombre;

    const hoy=new Date();
    $('rptFecha').textContent=hoy.toLocaleDateString('es-MX',{year:'numeric',month:'long',day:'numeric'});
    $('rptNombre').textContent=nombre||'‚Äî';

    const edad=reportState.edad!=null?reportState.edad:parseFloat($('edad').value||0);
    $('rptEdad').textContent=edad?`${edad} a√±os`:'‚Äî';
    $('rptEdadHoy').textContent=edad||'‚Äî';

    const metaHoy=reportState.metaHoy!=null?reportState.metaHoy:parseFloat($('metaHoy').value||0);
    $('rptMetaHoy').textContent=metaHoy?money(metaHoy):'‚Äî';

    const years=reportState.planYears!=null?reportState.planYears:parseFloat($('years').value||0);
    $('rptPlazo').textContent=years?`${years} a√±os`:'‚Äî';

    const pmtReal=parseFloat($('pmt').value||0);
    $('rptAportReal').textContent=pmtReal?money(pmtReal):'‚Äî';
    $('rptAportMensual').textContent=pmtReal?money(pmtReal):'‚Äî';

    const infl=reportState.infl!=null?reportState.infl:parseFloat($('inflation').value||0);
    const rAcc=reportState.rAcc!=null?reportState.rAcc:parseFloat($('rate').value||0);
    const yrsRet=reportState.yrsRet!=null?reportState.yrsRet:parseInt($('yrsRetSel').value||20,10);
    const rRet=reportState.rRet!=null?reportState.rRet:7;

    $('rptSupuestos1').textContent=
      `Supuestos: Inflaci√≥n ${infl.toFixed(1)}% anual, rendimiento en acumulaci√≥n ${rAcc.toFixed(1)}% nominal, retiro de ${yrsRet} a√±os con ${rRet.toFixed(1)}% nominal.`;

    if(reportState.regimenFiscal==='151'&&reportState.isrPct>0&&reportState.benefFiscal>0){
      $('rptSupuestosFiscal').textContent=`Tratamiento fiscal: Art. 151 (deducible), devoluci√≥n ISR ~${reportState.isrPct.toFixed(0)}% reinvertida en el plan.`;
    }else if(reportState.regimenFiscal==='93'){
      $('rptSupuestosFiscal').textContent=`Tratamiento fiscal: Art. 93 (diferido). No se modela devoluci√≥n anual.`;
    }else{
      $('rptSupuestosFiscal').textContent=`Sin beneficio fiscal inmediato modelado en esta proyecci√≥n.`;
    }

    $('rptTotalAportado').textContent=reportState.totalAportado?money(reportState.totalAportado):'‚Äî';
    $('rptFondoPlan').textContent=reportState.fondoPlan?money(reportState.fondoPlan):'‚Äî';
    $('rptFondo65').textContent=reportState.fondo65?money(reportState.fondo65):'‚Äî';
    $('rptIngresoMensual').textContent=reportState.ingresoMensual?money(reportState.ingresoMensual):'‚Äî';

    // Timeline
    $('rptEdadFinPlan').textContent=reportState.edadFinPlan||'‚Äî';
    $('rptFondoFinPlan').textContent=reportState.fondoPlan?money(reportState.fondoPlan):'‚Äî';
    $('rptFondo65Timeline').textContent=reportState.fondo65?money(reportState.fondo65):'‚Äî';
    $('rptYearsGrowth').textContent=reportState.yearsGrowth?`${reportState.yearsGrowth} a√±os`:'0 a√±os';

    // Comparativa PDF
    $('rptCompTitle').textContent=`¬øD√≥nde est√° tu dinero en ${years} a√±os?`;
    
    if(reportState.totalAportado>0 && years>0){
      const totalMeses=years*12;
      const aportMensual=pmtReal;
      const inflDec=infl/100;
      
      const colchonNominal=totalMeses*aportMensual;
      const colchonReal=colchonNominal/Math.pow(1+inflDec,years);
      
      const iBanco=0.02/12;
      let saldoBanco=0;
      for(let m=0;m<totalMeses;m++){
        saldoBanco*=(1+iBanco);
        saldoBanco+=aportMensual;
      }
      const bancoReal=saldoBanco/Math.pow(1+inflDec,years);
      
      const iAfore=0.09/12;
      let saldoAfore=0;
      for(let m=0;m<totalMeses;m++){
        saldoAfore*=(1+iAfore);
        saldoAfore+=aportMensual;
      }
      
      $('rptCompMattress').textContent=money(colchonNominal);
      $('rptCompMattressLoss').textContent=`Vale ${money(colchonReal)}`;
      
      $('rptCompBank').textContent=money(saldoBanco);
      $('rptCompBankLoss').textContent=`Vale ${money(bancoReal)}`;
      
      $('rptCompAfore').textContent=money(saldoAfore);
      $('rptCompAforeLoss').textContent=`Pensi√≥n limitada`;
      
      $('rptCompPlan').textContent=money(reportState.fondoPlan);
    }

    // Posponer
    const esc=reportState.delayScenarios;
    if(esc && reportState.pmtSugerido!=null){
      const base=esc[0]||0;
      function deltaTxt(pmtDelay){
        if(!base||!pmtDelay)return '‚Äî';
        const diff=pmtDelay-base;
        if(diff<=0)return 'Igual';
        const pct=diff/base*100;
        return `+${money(diff)} (+${pct.toFixed(1)}%)`;
      }

      $('rptHoyMonto').textContent=base?money(base):'‚Äî';
      $('rptHoyDelta').textContent='‚Äî';
      $('rpt1Monto').textContent=esc[1]?money(esc[1]):'‚Äî';
      $('rpt1Delta').textContent=deltaTxt(esc[1]);
      $('rpt3Monto').textContent=esc[3]?money(esc[3]):'‚Äî';
      $('rpt3Delta').textContent=deltaTxt(esc[3]);
      $('rpt5Monto').textContent=esc[5]?money(esc[5]):'‚Äî';
      $('rpt5Delta').textContent=deltaTxt(esc[5]);

      const nombreShow=nombre||'Tu decisi√≥n';
      $('rptMensajePosponer').textContent=
        `${nombreShow} de hoy define tu esfuerzo ma√±ana. Posponer 1, 3 o 5 a√±os aumenta significativamente la aportaci√≥n mensual necesaria para alcanzar la misma meta. Empezar antes casi siempre es m√°s barato.`;
    }
  }

  function exportCSV(){
    const rows=[['A√±o','Edad','Aportado (MXN)','Beneficio fiscal (MXN)','Saldo (MXN)']];
    document.querySelectorAll('#tbody tr').forEach(tr=>{
      const t=[...tr.querySelectorAll('td')].map(td=>td.textContent.replace(/[^\d.,\-a-z√± ]/gi,''));
      rows.push(t);
    });
    const blob=new Blob([rows.map(r=>r.join(',')).join('\n')],{type:'text/csv;charset=utf-8;'});
    const a=document.createElement('a');
    const name=$('nombreOpt').value||'Proyeccion';
    const f=new Date().toISOString().slice(0,10);
    a.href=URL.createObjectURL(blob);
    a.download=`${name}_plan_retiro_${f}.csv`;
    a.click();
    URL.revokeObjectURL(a.href);
  }

  function prepararPDF(){
    setTimeout(()=>{window.print()},250);
  }

  // Event Listeners
  $('pmt').addEventListener('input',()=>{
    userEditedPMT=true;
    $('pmt').classList.remove('suggested');
  });

  $('calcBtn').addEventListener('click',()=>{
    updateSuggestion();
    calcAccum();
  });

  $('resetBtn').addEventListener('click',()=>{
    $('nombreOpt').value='';
    $('edad').value=29;
    $('years').value=15;
    $('metaHoy').value=32000;
    $('pmt').value=2500;
    userEditedPMT=false;
    $('pmt').classList.remove('suggested');
    $('suggestedBadge').style.display='none';
    $('frequency').value=12;
    $('lumpSum').value=0;
    $('rate').value=10;
    $('inflation').value=4;
    $('regimenFiscal').value='ninguno';
    $('isrPct').value='20';
    $('reinvertISR').checked=true;
    $('regimenFiscal').dispatchEvent(new Event('change'));
    updateSuggestion();
    calcAccum();
  });

  $('calcRet').addEventListener('click',calcRet);
  $('csvBtn').addEventListener('click',exportCSV);
  $('printBtn').addEventListener('click',prepararPDF);

  $('advancedToggle').addEventListener('click',function(){
    const content=$('advancedContent');
    content.classList.toggle('visible');
    this.classList.toggle('open');
  });

  $('toggleTable').addEventListener('click',function(){
    const d=$('details');
    d.classList.toggle('visible');
    this.classList.toggle('open');
  });
  
  $('toggleTableRet').addEventListener('click',function(){
    const d=$('detailsRet');
    d.classList.toggle('visible');
    this.classList.toggle('open');
  });

  ['edad','years','metaHoy','rate','inflation','yrsRetSel'].forEach(id=>{
    $(id).addEventListener('change',()=>{
      if(!userEditedPMT)updateSuggestion();
    });
  });

  ['frequency','lumpSum','regimenFiscal','isrPct','reinvertISR'].forEach(id=>{
    $(id).addEventListener('change',
